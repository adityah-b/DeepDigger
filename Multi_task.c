#include <lpc17xx.h>
#include <stdio.h>
#include <stdbool.h>
#include <RTL.h>

#include "GLCD.h"

// Macros
#define MAX_SCREEN_LENGTH 100
#define MAX_SCREEN_WIDTH 100
#define GOLD 10
#define SILVER 5
#define COPPER 1


// Global Variables
uint32_t min_row, min_col;
uint32_t max_row, max_col;
char map[MAX_SCREEN_WIDTH][MAX_SCREEN_LENGTH]; // Temporary

// Tasks
__task void updateDisplay(void);
__task void pollPushButton(void);
__task void pollJoystick(void);
__task void updateFuelStatus(void);
__task void moveRobot(void);
__task void buyFuel(void);

/* Character Struct */
typedef struct {
	volatile uint32_t x_pos, y_pos;
	
	uint32_t num_gold, num_silver, num_copper;
	uint32_t fuel_status;
	uint32_t num_points;
	
	bool is_flying;
	
	// Robot Inputs
	volatile uint32_t dir;
	volatile uint32_t select_action;
} robot_t;
robot_t robot;
/* Character Struct */


/* Semaphore Implementation */
typedef uint32_t sem_t;
sem_t action_performed, display_refreshed;

void init(sem_t *s, uint32_t count)
{
	*s = count;
}

void wait(sem_t *s)
{
	__disable_irq();
	while(*s ==0)	{
		__enable_irq();
		__disable_irq();
	}
	(*s)--;
	__enable_irq();
}

void signal(sem_t *s)
{
	__disable_irq();
	(*s)++;
	__enable_irq();
}
/* Semaphore Implementation */


__task void mainTask(void)
{
	// Create tasks
	os_tsk_create(updateDisplay, 1);
	
	os_tsk_create(pollPushButton, 2);
	os_tsk_create(pollJoystick, 2);
	
	os_tsk_create(updateFuelStatus, 3);
	os_tsk_create(moveRobot, 3);
	
	os_tsk_create(buyFuel, 4);

	
	os_tsk_delete_self();
}

__task void updateDisplay(void)
{
	os_itv_set(10);
	
	while(1)
	{
		// Declare current row and column
		uint32_t row, col;

		// Wait until something has changed on the screen
		wait(&action_performed);

		GLCD_SetTextColor(Blue);
		GLCD_SetBackColor(Blue);
		GLCD_Clear(Blue);

		for (row=min_row; row<max_row; row++)
		{
			for (col=min_col; col<max_col; col++)
			{
				// Print char value of array element at {row, col} on LCD Display
				
				GLCD_Bitmap(row,col,40,40, digger_bmp2);
			}
		}
		// Signal that LCD Display has been redrawn	
		signal(&display_refreshed);
		os_tsk_pass();
	}
}

__task void pollPushButton(void)
{
	os_itv_set(10);
	
	// Sensor Fusion Algorithm Initialization
	
	while(1)
	{
		// Wait until IMU data has been read
		wait(&cond_1);
		
		// Update data
	
		// Signal that sensorFusion algorithm has been run successfully
		signal(&cond_2);
		os_tsk_pass();
	}
}

__task void pollJoystick(void)
{
	os_itv_set(10);
	
	while(1)
	{
		// Wait until sensorFusion algorithm has been run
		wait(&cond_2);
		
		// Output data to game
		//printf("%f,%f,%f\n", sensor_fusion_getRoll(), -sensor_fusion_getYaw(), sensor_fusion_getPitch());
		os_tsk_pass();
	}
}

__task void updateFuelStatus(void)
{
	os_itv_set(10);
	
	while(1)
	{
		// Wait until sensorFusion algorithm has been run
		wait(&cond_2);
		
		// Output data to game
		//printf("%f,%f,%f\n", sensor_fusion_getRoll(), -sensor_fusion_getYaw(), sensor_fusion_getPitch());
		os_tsk_pass();
	}
}
__task void moveRobot(void)
{
	os_itv_set(10);
	
	while(1)
	{
		
		// Wait until sensorFusion algorithm has been run
		wait(&cond_2);
		
		// Output data to game
		//printf("%f,%f,%f\n", sensor_fusion_getRoll(), -sensor_fusion_getYaw(), sensor_fusion_getPitch());
		os_tsk_pass();
	}
}
__task void buyFuel(void)
{
	os_itv_set(10);
	
	while(1)
	{
		if (map[robot.x_pos][robot.y_pos] == 'F' && robot.select_action)
		{
			uint32_t num_bars = 8 - robot.fuel_status;
			uint32_t cost = 2*num_bars;
			robot.fuel_status = 8;
			robot.num_points -= cost;
		}
		os_tsk_pass();
	}
}

uint8_t digger_bmp[] = {
	0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x96, 0xb5, 0x71, 0x8c, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0xb2, 0x94, 0xdf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x69, 0x4a, 0x41, 0x08, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x41, 0x08, 0xbe, 0xf7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3c, 0xe7, 0x20, 0x00, 0x24, 0x21, 0x82, 0x10, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0xc3, 0x18, 0xc3, 0x18, 0x4d, 0x6b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x82, 0x10, 0x5d, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x2c, 0x63, 0xc3, 0x18, 0x41, 0x08, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3c, 0xe7, 0xb6, 0xb5, 0x3c, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x82, 0x10, 0xba, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x3c, 0xe7, 0x41, 0x08, 0xa2, 0x10, 0x51, 0x8c, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xb2, 0x94, 0x20, 0x00, 0x82, 0x10, 0x61, 0x08, 0x82, 0x10, 0x86, 0x31, 0xeb, 0x5a, 0x51, 0x8c, 0xd7, 0xbd, 0x3c, 0xe7, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x82, 0x10, 0xba, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x28, 0x42, 0xe3, 0x18, 0xa2, 0x10, 0xff, 0xff, 0xff, 0xff, 0xcb, 0x5a, 0x61, 0x08, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x04, 0x21, 0xe3, 0x18, 0xa2, 0x10, 0x82, 0x10, 0x61, 0x08, 0x82, 0x10, 0x7d, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x82, 0x10, 0xba, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x38, 0xc6, 0x61, 0x08, 0x82, 0x10, 0x96, 0xb5, 0x1c, 0xe7, 0x00, 0x00, 0x24, 0x21, 0x24, 0x21, 0xe3, 0x18, 0xc3, 0x18, 0xe3, 0x18, 0x04, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0xa2, 0x10, 0x8e, 0x73, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x82, 0x10, 0xba, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x45, 0x29, 0xe3, 0x18, 0x45, 0x29, 0xff, 0xff, 0x08, 0x42, 0xe3, 0x18, 0x61, 0x08, 0xeb, 0x5a, 0xef, 0x7b, 0x28, 0x42, 0xc3, 0x18, 0x41, 0x08, 0x82, 0x10, 0x24, 0x21, 0x24, 0x21, 0xc3, 0x18, 0x6d, 0x6b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x82, 0x10, 0xfb, 0xde, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x34, 0xa5, 0x82, 0x10, 0x61, 0x08, 0x9a, 0xd6, 0x79, 0xce, 0x00, 0x00, 0xb2, 0x94, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x59, 0xce, 0x82, 0x10, 0x24, 0x21, 0xc3, 0x18, 0x8e, 0x73, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x61, 0x08, 0xc3, 0x18, 0x71, 0x8c, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xc3, 0x18, 0xe3, 0x18, 0x49, 0x4a, 0xff, 0xff, 0x38, 0xc6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x61, 0x08, 0x24, 0x21, 0xc3, 0x18, 0x8e, 0x73, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x79, 0xe7, 0x15, 0xd7, 0xf5, 0xce, 0xf5, 0xce, 0x58, 0xdf, 0xff, 0xff, 0x61, 0x08, 0x04, 0x21, 0x61, 0x08, 0xae, 0x73, 0xb2, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0xf3, 0x9c, 0x69, 0x4a, 0x04, 0x21, 0x41, 0x08, 0xdf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdf, 0xff, 0x61, 0x08, 0x24, 0x21, 0xc3, 0x18, 0x8e, 0x73, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xea, 0x9d, 0xc8, 0x95, 0xc9, 0x9d, 0xe9, 0x9d, 0xc9, 0x9d, 0xa8, 0x95, 0xff, 0xff, 0xdb, 0xde, 0x41, 0x08, 0x04, 0x21, 0xc3, 0x18, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x04, 0x21, 0x24, 0x21, 0x20, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdf, 0xff, 0x61, 0x08, 0x24, 0x21, 0xc3, 0x18, 0x8e, 0x73, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x70, 0xbe, 0xe9, 0x9d, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0xea, 0x9d, 0xea, 0xa5, 0xff, 0xff, 0xbb, 0xde, 0x41, 0x08, 0x04, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x41, 0x08, 0xae, 0x73, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x61, 0x08, 0x24, 0x21, 0xe3, 0x18, 0x2c, 0x63, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x4e, 0xb6, 0xea, 0x9d, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0xea, 0x9d, 0xea, 0x9d, 0xff, 0xff, 0xdb, 0xde, 0x41, 0x08, 0x04, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x04, 0x21, 0x41, 0x08, 0x34, 0xa5, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x82, 0x10, 0x24, 0x21, 0x24, 0x21, 0xa2, 0x10, 0x69, 0x4a, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x4e, 0xb6, 0xea, 0x9d, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0xea, 0x9d, 0xea, 0x9d, 0xff, 0xff, 0xbb, 0xde, 0x20, 0x00, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x82, 0x10, 0x04, 0x21, 0x7e, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x28, 0x42, 0xe3, 0x18, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0xa2, 0x10, 0x08, 0x42, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x4e, 0xb6, 0xea, 0x9d, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0xea, 0x9d, 0xea, 0x9d, 0xff, 0xff, 0xbf, 0xff, 0xb3, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x35, 0xa5, 0xff, 0xff, 0xdc, 0xf7, 0xf4, 0xce, 0xf4, 0xce, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdb, 0xde, 0x41, 0x08, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x61, 0x08, 0xb6, 0xb5, 0xff, 0xff, 
  0xff, 0xff, 0x4e, 0xb6, 0xea, 0x9d, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0xea, 0x9d, 0xe9, 0x9d, 0x36, 0xdf, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xdc, 0xf7, 0xd2, 0xc6, 0xc8, 0x95, 0xc9, 0x9d, 0xc8, 0x95, 0x6f, 0xb6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x08, 0x42, 0xe3, 0x18, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0xe3, 0x18, 0xcb, 0x5a, 0xff, 0xff, 
  0xff, 0xff, 0x4e, 0xb6, 0xea, 0x9d, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0x0a, 0xa6, 0xea, 0xa5, 0xc9, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc9, 0x9d, 0xe9, 0x9d, 0xea, 0xa5, 0x0a, 0xa6, 0xea, 0x9d, 0x4e, 0xb6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xdb, 0xde, 0x41, 0x08, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0xe3, 0x18, 0x69, 0x4a, 0xff, 0xff, 
  0xff, 0xff, 0xb1, 0xbe, 0xa7, 0x95, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xc8, 0x9d, 0xa7, 0x95, 0xb1, 0xbe, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x08, 0x42, 0xe3, 0x18, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0xc3, 0x18, 0xcf, 0x7b, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0x9b, 0xef, 0x9b, 0xef, 0xdc, 0xf7, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xfd, 0xff, 0xdc, 0xf7, 0x9b, 0xef, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x79, 0xce, 0x61, 0x08, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x20, 0x00, 0x5d, 0xef, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7e, 0xef, 0x14, 0xa5, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0xd3, 0x9c, 0x9a, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xd7, 0xbd, 0xa6, 0x31, 0x82, 0x10, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x61, 0x08, 0x30, 0x84, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xeb, 0x5a, 0x20, 0x00, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x41, 0x08, 0x86, 0x31, 0xdf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xa2, 0x10, 0xc3, 0x18, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x24, 0x21, 0x04, 0x21, 0xe3, 0x18, 0x20, 0x00, 0xcf, 0x7b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0x49, 0x4a, 0xa2, 0x10, 0xe3, 0x18, 0x61, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0xc3, 0x18, 0xe3, 0x18, 0xc3, 0x18, 0xff, 0xff, 0xff, 0xff, 0x71, 0x8c, 0x00, 0x00, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0xa2, 0x10, 0x8a, 0x52, 0xba, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x18, 0xc6, 0x41, 0x08, 0xc3, 0x18, 0x8a, 0x52, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x51, 0x8c, 0x82, 0x10, 0xa2, 0x10, 0xcf, 0x7b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x2c, 0x63, 0xc3, 0x18, 0xe3, 0x18, 0xff, 0xff, 0x92, 0x94, 0x49, 0x4a, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x4d, 0x6b, 0x4d, 0x6b, 0xff, 0xff, 0xaa, 0x52, 0xc3, 0x18, 0x04, 0x21, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x49, 0x4a, 0xa2, 0x10, 0x8a, 0x52, 0xff, 0xff, 0x00, 0x00, 0x00, 0x00, 0xd3, 0x9c, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xba, 0xd6, 0x00, 0x00, 0x00, 0x00, 0x1c, 0xe7, 0xf3, 0x9c, 0xa2, 0x10, 0x20, 0x00, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x2c, 0x63, 0xc3, 0x18, 0xe3, 0x18, 0xff, 0xff, 0xd3, 0x9c, 0x8a, 0x52, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x4d, 0x6b, 0x4d, 0x6b, 0xff, 0xff, 0xaa, 0x52, 0xc3, 0x18, 0x04, 0x21, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0x18, 0xc6, 0x41, 0x08, 0xc3, 0x18, 0x8a, 0x52, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x51, 0x8c, 0x82, 0x10, 0xa2, 0x10, 0xcf, 0x7b, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0x49, 0x4a, 0xa2, 0x10, 0xe3, 0x18, 0x61, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0x41, 0x08, 0xc3, 0x18, 0xe3, 0x18, 0xc3, 0x18, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xcb, 0x5a, 0x20, 0x00, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0xa2, 0x10, 0x41, 0x08, 0x86, 0x31, 0xdf, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x5d, 0xef, 0xf3, 0x9c, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0x92, 0x94, 0xb2, 0x94, 0x9a, 0xd6, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 
  0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 

};




int main(void)
{
	unsigned char *direction, *button_pressed;
	uint32_t val; 
	uint32_t mask = 15 << 23;
	
	unsigned char *digger_bmp2;
	int i = 160, j = 120;
	int count = 0;
	// Initialize semaphores to 0
	init(&cond_1, 0);
	init(&cond_2, 0);
	
	// Initialize peripherals
	LED_setup();
	GLCD_Init();
	digger_bmp2 = (unsigned char *)digger_bmp;
	while (1)
	{
		val = LPC_GPIO1 -> FIOPIN;
		switch(~val & mask)
		{
			case 1 << 23 :
				//direction = "RIGHT ";
				i+=40;
				break;
			case 1 << 24 :
				//direction = "DOWN  ";
				j+=40;
				break;
			case 1 << 25 :
				//direction = "LEFT  ";
				i-=40;
				break;
			case 1 << 26 :
				//direction = "UP    ";
				j-=40;
				break;
			default:
				direction = "No Dir";
		}
	
		if (i+40 >= 320) i = 0;
		GLCD_SetTextColor(Blue);
		GLCD_SetBackColor(Blue);
		GLCD_Clear(Blue);
		while(count <= 1000)
		{
			count++;
		}
		count = 0;
		GLCD_Bitmap(i,j,40,40, digger_bmp2);
//		i+=40;
		while(count <= 10000000){ 
			count++;
		}
		count = 0;
	}
	printf("Starting Program");
	
	// Initialize main task
	//os_sys_init(mainTask);
}

/* run update map, map array should be 100x100
initially, 
min_row = 0, max_row = 6
min_col = 0, max_col = 8

in char array, position of robot marked with X
when printing, if array[x_pos][y_pos] == X, run task to print robot bitmap
then continue from there
*/